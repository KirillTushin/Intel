/*
 * assem.c
 * 
 * Tushin Kirill
 * 
 * 
 */
#include <stdio.h> 
#include <stdlib.h>

int PUSH(int *t,char arr[]);
int POP(int* t,char arr[]);
int ADD(int* t,char arr[]);
int SUB(int* t,char arr[]);
int MUL(int* t,char arr[]);
int DIV(int* t,char arr[]);
int strtoInt(int *t,char arr[]);

int main (void)
{  

	FILE *mf;

	char* sym;
	char c;
	int a = 0;
	int i = 0;

	mf = fopen ("test.asem","r");			//Считваем из файла команды
	
	while(1)
	{
		c = fgetc(mf);						//Подсчитываем их количество
		if(c == EOF)
			break;
		a++;
	}
	sym = malloc((a+1)*sizeof(char));		//создаем массив из символов	

	mf = fopen ("test.asem","r");
	
	while (1)
	{
		sym[i] = fgetc (mf);				//заносим в каждый элемент массива символ
		if (sym[i] == EOF)					
			break;
		i++;
	}
	i--;
		
	mf = fopen ("my.forcpu","w");			//будем записывать в файл my.asem
	
	int t = 0;
	while(t < i)
	{
		if(PUSH(&t, sym) == 1)
		{
			fprintf(mf,"%d %d ", 1, strtoInt(&t, sym));			//Функции заносим в новый файл как char а число после PUSH как int
			t++;
		}
		if(sym[t] == '\n')
			t++;
		if(POP(&t, sym) == 2)
		{
			fprintf(mf,"%d ", 2);	
			t++;
		}
		if(ADD(&t, sym) == 3)
		{
			fprintf(mf,"%d ", 3);	
			t++;
		}
		if(SUB(&t, sym) == 4)
		{
			fprintf(mf,"%d ", 4);	
			t++;
		}
		
		if(MUL(&t, sym) == 5)
		{
			fprintf(mf,"%d ", 5);	
			t++;
		}
		if(DIV(&t, sym) == 6)
		{
			fprintf(mf,"%d ", 6);	
			t++;
		}
	}
	free(sym);
	return 0;
} 




int PUSH(int* t,char arr[])					//сравниваем команды с введенными командами
{
	if (arr[*t] == 'P' ||arr[*t] == 'p')
		if(arr[*t+1] == 'U' ||arr[*t+1] == 'u')
			if(arr[*t+2] == 'S' ||arr[*t+2] == 's')
				if(arr[*t+3] == 'H' ||arr[*t+3] == 'h')
				{
					if(arr[*t+4] ==' ')
						*t+=1;
					*t+=4;
					return 1;
				}
	return 0;
}


int POP(int* t,char arr[])
{
	if (arr[*t] == 'P' || arr[*t] == 'p')
		if(arr[*t+1] == 'O' ||arr[*t+1] == 'o')
			if(arr[*t+2] == 'P' ||arr[*t+2] == 'p')
			{
				*t+=3;
				return 2;
			}
	return 0;
}

int ADD(int* t,char arr[])
{
	if (arr[*t] == 'A' || arr[*t] =='a')
		if(arr[*t+1] == 'D' || arr[*t+1] =='d')
			if(arr[*t+2] == 'D' || arr[*t+2] =='d')
			{
				*t+=3;
				return 3;
			}
	return 0;
}

int SUB(int* t,char arr[])
{
	if (arr[*t] == 'S' ||arr[*t] == 's')
		if(arr[*t+1] == 'U' || arr[*t+1] =='u')
			if(arr[*t+2] == 'B' || arr[*t+2] =='b')
			{
				*t+=3;
				return 4;
			}
	return 0;
}

int MUL(int* t,char arr[])
{
	if (arr[*t] == 'M' || arr[*t] =='m')
		if(arr[*t+1] == 'U' ||arr[*t+1] == 'u')
			if(arr[*t+2] == 'L' ||arr[*t+2] == 'l')
			{
				*t+=3;
				return 5;
			}
	return 0;
}


int DIV(int* t,char arr[])
{
	if (arr[*t] == 'D' || arr[*t] =='d')
		if(arr[*t+1] == 'I' ||arr[*t+1] == 'i')
			if(arr[*t+2] == 'V' ||arr[*t+2] == 'v')
			{
				*t+=3;
				return 6;
			}
	return 0;
}

int strtoInt(int *t,char arr[])
{
	int a = 0;
	int p = *t;
	int c = 0;
	while(arr[p] != '\n')
	{
		a = a*10 + (arr[p] - '0');
		p++;
		c++;
	}
	*t += c;
	return a;
}
